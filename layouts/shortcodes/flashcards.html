<!-- layouts/shortcards/flashcards.html -->
{{ $indexPage := .Page.Parent }}
{{ if not $indexPage }}
  {{ $indexPage = .Page.Site.GetPage (.Page.Dir | strings.TrimSuffix "/") }}
{{ end }}
{{ if $indexPage.Params.lexicon }}
<div class="flashcards-container">
    <div class="flashcards-header">
        <h3>üìö Flashcards - {{ $indexPage.Title }}</h3>
        <div class="flashcards-controls">
            <div class="mode-selector">
                <label class="mode-option">
                    <input type="radio" name="study-mode" value="term-to-definition" checked>
                    <span>Term ‚Üí Definition</span>
                </label>
                <label class="mode-option">
                    <input type="radio" name="study-mode" value="definition-to-term">
                    <span>Definition ‚Üí Term</span>
                </label>
            </div>
            <div class="control-buttons">
                <button id="shuffle-btn" class="btn btn-secondary">üîÄ Shuffle</button>
                <button id="reset-progress" class="btn btn-outline">üîÑ Reset</button>
            </div>
            <div class="progress-display">
                <span id="current-card">1</span> / <span id="total-cards">{{ len $indexPage.Params.lexicon }}</span>
            </div>
        </div>
    </div>
    
    <div class="flashcard-wrapper">
        <div class="flashcard" id="flashcard">
            <div class="flashcard-inner">
                <div class="flashcard-front">
                    <div class="card-content">
                        <div class="question" id="card-question"></div>
                        <div class="card-hint">Tap to reveal answer</div>
                    </div>
                </div>
                <div class="flashcard-back">
                    <div class="card-content">
                        <div class="question-small" id="card-question-back"></div>
                        <div class="answer" id="card-answer"></div>
                        <div class="card-hint">Tap to flip back</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="flashcards-navigation">
        <div class="nav-top">
            <button id="next-btn" class="btn btn-primary">Next ‚Üí</button>
        </div>
        <div class="nav-middle">
            <div class="difficulty-buttons">
                <button id="easy-btn" class="btn btn-success">üòä Easy</button>
                <button id="medium-btn" class="btn btn-warning">ü§î Medium</button>
                <button id="hard-btn" class="btn btn-danger">üò∞ Hard</button>
            </div>
        </div>
        <div class="nav-bottom">
            <button id="prev-btn" class="btn btn-primary">‚Üê Previous</button>
        </div>
    </div>
    
    <div class="progress-stats">
        <div class="stat">
            <span class="stat-label">Reviewed:</span>
            <span id="reviewed-count">0</span>
        </div>
        <div class="stat">
            <span class="stat-label">Easy:</span>
            <span id="easy-count">0</span>
        </div>
        <div class="stat">
            <span class="stat-label">Need Review:</span>
            <span id="review-count">0</span>
        </div>
    </div>
</div>

<style>
.flashcards-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 1rem;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    gap: 1rem; /* Increased spacing between major sections */
}

/* Header styles - horizontal layout for desktop */
.flashcards-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.flashcards-header h3 {
    margin: 0;
    color: #333;
    font-size: clamp(1.2rem, 4vw, 1.5rem);
}

.flashcards-controls {
    display: flex;
    align-items: center;
    gap: 1.2rem; /* Increased spacing between control elements */
    flex-wrap: wrap;
    padding: 0.5rem 0;
}

.mode-selector {
    display: flex;
    gap: 0.8rem; /* Increased spacing between radio options */
    align-items: center;
}

.mode-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    padding: 0.5rem 0.75rem;
    border-radius: 20px;
    background: #f8f9fa;
    transition: all 0.2s ease;
    font-size: clamp(0.75rem, 3vw, 0.9rem);
    white-space: nowrap;
}

.mode-option:hover {
    background: #e9ecef;
}

.mode-option input[type="radio"] {
    margin: 0;
}

.mode-option input[type="radio"]:checked + span {
    font-weight: bold;
    color: #007bff;
}

.control-buttons {
    display: flex;
    gap: 0.8rem; /* Increased spacing between buttons */
}

.progress-display {
    background: #f5f5f5;
    padding: 0.5rem 0.75rem;
    border-radius: 20px;
    font-weight: bold;
    color: #666;
    font-size: clamp(0.8rem, 3vw, 0.9rem);
}

/* Flashcard styles */
.flashcard-wrapper {
    perspective: 1000px;
    margin: 1.5rem 0; /* Increased vertical margins */
    display: flex;
    align-items: center;
}

.flashcard {
    width: 100%;
    height: clamp(220px, 35vh, 320px); /* Taller card with responsive height */
    position: relative;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.flashcard:hover {
    transform: translateY(-2px);
}

.flashcard-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.6s;
    transform-style: preserve-3d;
}

.flashcard.flipped .flashcard-inner {
    transform: rotateY(180deg);
}

.flashcard-front, .flashcard-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    justify-content: center;
}

.flashcard-front {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.flashcard-back {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    transform: rotateY(180deg);
}

.card-content {
    padding: clamp(1.5rem, 5vw, 2.5rem); /* Increased padding */
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    box-sizing: border-box;
    overflow: hidden;
}

.term, .question {
    font-size: clamp(1.4rem, 5vw, 2rem);
    font-weight: bold;
    margin-bottom: 1rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    line-height: 1.3;
    overflow-wrap: break-word;
    hyphens: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    height: 100%;
    margin: 0 auto;
}

.term-small, .question-small {
    font-size: clamp(0.85rem, 3.2vw, 1.1rem);
    font-weight: bold;
    margin-bottom: 0.75rem;
    opacity: 0.8;
    line-height: 1.3;
    overflow-wrap: break-word;
    text-align: center;
}

.definition, .answer {
    font-size: clamp(1.4rem, 5vw, 2rem);
    font-weight: bold;
    margin-bottom: 1rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    line-height: 1.3;
    overflow-wrap: break-word;
    hyphens: auto;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.card-hint {
    font-size: clamp(0.7rem, 2.3vw, 0.85rem);
    opacity: 0.7;
    font-style: italic;
    margin-top: auto;
    text-align: center;
}

/* Navigation styles */
.flashcards-navigation {
    display: flex;
    flex-direction: column;
    gap: 0.75rem; /* Increased spacing between navigation rows */
    margin: 1.5rem 0; /* Increased vertical margins */
}

.nav-top, .nav-bottom {
    display: flex;
    justify-content: center;
}

.nav-middle {
    display: flex;
    justify-content: center;
}

.difficulty-buttons {
    display: flex;
    gap: 0.8rem; /* Increased spacing between difficulty buttons */
    justify-content: center;
}

.btn {
    padding: clamp(0.4rem, 1.8vw, 0.6rem) clamp(0.8rem, 2.5vw, 1rem);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s ease;
    font-size: clamp(0.75rem, 2.8vw, 0.85rem);
    white-space: nowrap;
    min-width: fit-content;
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-warning {
    background: #ffc107;
    color: #212529;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-outline {
    background: transparent;
    border: 2px solid #6c757d;
    color: #6c757d;
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.progress-stats {
    display: flex;
    justify-content: space-around;
    background: #f8f9fa;
    padding: 0.75rem; /* Increased padding */
    border-radius: 10px;
    flex-wrap: wrap;
    gap: 0.75rem; /* Increased gap */
    margin-top: 1rem;
}

.stat {
    text-align: center;
    flex: 1;
    min-width: 70px;
}

.stat-label {
    display: block;
    font-size: clamp(0.65rem, 2.3vw, 0.75rem);
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat span:last-child {
    display: block;
    font-size: clamp(1rem, 3.5vw, 1.3rem);
    font-weight: bold;
    color: #333;
    margin-top: 0.25rem;
}

/* Mobile-specific styles */
@media (max-width: 768px) {
    .flashcards-container {
        padding: 0.75rem;
        gap: 0.75rem; /* Slightly reduced gap for mobile */
    }
    
    /* Switch to vertical layout for header on mobile */
    .flashcards-header {
        flex-direction: column;
        align-items: flex-start;
        margin-bottom: 0.75rem;
        gap: 0.75rem;
    }
    
    .flashcards-controls {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
        width: 100%;
    }
    
    .mode-selector {
        width: 100%;
        justify-content: flex-start;
    }
    
    .control-buttons {
        width: 100%;
        justify-content: flex-start;
    }
    
    .progress-display {
        align-self: flex-start;
    }
    
    .flashcard {
        height: clamp(180px, 30vh, 250px); /* Adjusted for mobile */
    }
    
    .flashcard-wrapper {
        margin: 1rem 0; /* Reduced margin on mobile */
    }
    
    .flashcards-navigation {
        margin: 1rem 0; /* Reduced margin on mobile */
        gap: 0.5rem;
    }
    
    .card-content {
        padding: clamp(1.2rem, 4vw, 2rem); /* Reduced padding on mobile */
    }
    
    .difficulty-buttons {
        gap: 0.5rem; /* Reduced gap on mobile */
    }
}

/* Very small screens */
@media (max-width: 480px) {
    .flashcards-container {
        padding: 0.5rem;
    }
    
    .flashcard {
        height: clamp(150px, 28vh, 220px); /* Further adjusted for very small screens */
    }
    
    .flashcard-wrapper {
        margin: 0.75rem 0;
    }
    
    .flashcards-navigation {
        margin: 0.75rem 0;
    }
    
    .card-content {
        padding: clamp(1rem, 3.5vw, 1.5rem);
    }
}

/* Landscape orientation on mobile */
@media (max-height: 500px) and (orientation: landscape) {
    .flashcard {
        height: clamp(120px, 45vh, 180px); /* Optimized for landscape */
    }
    
    .flashcard-wrapper {
        margin: 0.5rem 0;
    }
    
    .flashcards-navigation {
        margin: 0.5rem 0;
        gap: 0.3rem;
    }
    
    .flashcards-header h3 {
        font-size: 1rem;
    }
    
    .progress-stats {
        padding: 0.5rem;
    }
    
    .card-content {
        padding: clamp(0.8rem, 3vw, 1.2rem);
    }
}
</style>

<script>
(function() {
    // Flashcard data from Hugo - only include terms with definitions
    const flashcards = [
        {{ range $indexPage.Params.lexicon }}
        {{ if and .term .definition }}
        {
            term: {{ .term | jsonify }},
            definition: {{ .definition | jsonify }}
        },
        {{ end }}
        {{ end }}
    ];
    
    let currentIndex = 0;
    let isFlipped = false;
    let cardOrder = [...Array(flashcards.length).keys()];
    let studyMode = 'term-to-definition'; // 'term-to-definition' or 'definition-to-term'
    let stats = {
        reviewed: 0,
        easy: 0,
        medium: 0,
        hard: 0
    };
    
    // Storage key based on parent page for unique progress per unit
    const storageKey = `flashcards_{{ $indexPage.RelPermalink }}`;
    
    // DOM elements
    const flashcard = document.getElementById('flashcard');
    const cardQuestion = document.getElementById('card-question');
    const cardQuestionBack = document.getElementById('card-question-back');
    const cardAnswer = document.getElementById('card-answer');
    const currentCardSpan = document.getElementById('current-card');
    const totalCardsSpan = document.getElementById('total-cards');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const shuffleBtn = document.getElementById('shuffle-btn');
    const resetBtn = document.getElementById('reset-progress');
    const easyBtn = document.getElementById('easy-btn');
    const mediumBtn = document.getElementById('medium-btn');
    const hardBtn = document.getElementById('hard-btn');
    const modeRadios = document.querySelectorAll('input[name="study-mode"]');
    
    // Stats elements
    const reviewedCount = document.getElementById('reviewed-count');
    const easyCount = document.getElementById('easy-count');
    const reviewCount = document.getElementById('review-count');
    
    function loadProgress() {
        const saved = localStorage.getItem(storageKey);
        if (saved) {
            const data = JSON.parse(saved);
            stats = data.stats || stats;
            cardOrder = data.cardOrder || cardOrder;
            currentIndex = Math.min(data.currentIndex || 0, cardOrder.length - 1);
            studyMode = data.studyMode || studyMode;
            
            // Set the radio button
            const radio = document.querySelector(`input[value="${studyMode}"]`);
            if (radio) radio.checked = true;
        }
        updateStatsDisplay();
    }
    
    function saveProgress() {
        const data = {
            stats,
            cardOrder,
            currentIndex,
            studyMode
        };
        localStorage.setItem(storageKey, JSON.stringify(data));
    }
    
    function updateCard() {
        const card = flashcards[cardOrder[currentIndex]];
        
        // Set question and answer based on study mode
        let question, answer;
        if (studyMode === 'term-to-definition') {
            question = card.term;
            answer = card.definition;
        } else {
            question = card.definition;
            answer = card.term;
        }
        
        cardQuestion.textContent = question;
        cardQuestionBack.textContent = question;
        cardAnswer.textContent = answer;
        
        currentCardSpan.textContent = currentIndex + 1;
        
        // Update button states
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === cardOrder.length - 1;
        
        // Reset flip state
        isFlipped = false;
        flashcard.classList.remove('flipped');
    }
    
    function updateStatsDisplay() {
        reviewedCount.textContent = stats.reviewed;
        easyCount.textContent = stats.easy;
        reviewCount.textContent = stats.medium + stats.hard;
    }
    
    function flipCard() {
        isFlipped = !isFlipped;
        flashcard.classList.toggle('flipped');
    }
    
    function nextCard() {
        if (currentIndex < cardOrder.length - 1) {
            currentIndex++;
            updateCard();
            saveProgress();
        }
    }
    
    function prevCard() {
        if (currentIndex > 0) {
            currentIndex--;
            updateCard();
            saveProgress();
        }
    }
    
    function shuffleCards() {
        // Fisher-Yates shuffle
        for (let i = cardOrder.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [cardOrder[i], cardOrder[j]] = [cardOrder[j], cardOrder[i]];
        }
        currentIndex = 0;
        updateCard();
        saveProgress();
    }
    
    function resetProgress() {
        stats = {
            reviewed: 0,
            easy: 0,
            medium: 0,
            hard: 0
        };
        cardOrder = [...Array(flashcards.length).keys()];
        currentIndex = 0;
        updateCard();
        updateStatsDisplay();
        saveProgress();
    }
    
    function markDifficulty(level) {
        if (!isFlipped) {
            flipCard();
            return;
        }
        
        stats.reviewed++;
        
        if (level === 'easy') {
            stats.easy++;
        } else if (level === 'medium') {
            stats.medium++;
        } else if (level === 'hard') {
            stats.hard++;
        }
        
        updateStatsDisplay();
        saveProgress();
        
        // Auto advance to next card if not the last one
        if (currentIndex < cardOrder.length - 1) {
            nextCard();
        }
    }
    
    function changeStudyMode(mode) {
        studyMode = mode;
        updateCard();
        saveProgress();
    }
    
    // Event listeners
    flashcard.addEventListener('click', flipCard);
    
    prevBtn.addEventListener('click', prevCard);
    nextBtn.addEventListener('click', nextCard);
    
    shuffleBtn.addEventListener('click', shuffleCards);
    resetBtn.addEventListener('click', resetProgress);
    
    easyBtn.addEventListener('click', () => markDifficulty('easy'));
    mediumBtn.addEventListener('click', () => markDifficulty('medium'));
    hardBtn.addEventListener('click', () => markDifficulty('hard'));
    
    modeRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
            changeStudyMode(e.target.value);
        });
    });
    
    // Initialize
    loadProgress();
    updateCard();
})();
</script>
{{ end }}

