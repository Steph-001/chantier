<!-- layouts/partials/supabase-auth-ui.html -->
<!-- This is a separate partial for the Supabase Auth UI -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/@supabase/auth-ui-shared@0.1.6/dist/supabase-auth-ui-shared.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@supabase/auth-ui-shared@0.1.6/dist/style.css">

<div id="auth-container" style="max-width: 400px; margin: 0 auto; padding: 20px;">
  <div id="auth-ui"></div>
  <div id="auth-status" style="margin-top: 20px; text-align: center; display: none;">
    <p id="auth-message"></p>
    <button id="logout-btn" class="btn btn-outline">Logout</button>
  </div>
</div>

<script>
  // Initialize Supabase client
  const SUPABASE_URL = 'https://kmykyjiyjkcupkrxcgrw.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtteWt5aml5amtjdXBrcnhjZ3J3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NjUxMDUsImV4cCI6MjA2NDA0MTEwNX0.iwY_-Yt05flxrd9GJmd4PdSjBhhNQZlNHUlUogfdmMw';
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  
  // Get current page URL for redirect
  const currentPage = window.location.href;
  
  // Initialize Auth UI
  const { createClient } = supabase;
  const { Auth } = supabaseAuthUi;
  
  // Check if user is already logged in
  async function checkUser() {
    const { data: { session } } = await supabase.auth.getSession();
    if (session) {
      // User is logged in
      document.getElementById('auth-ui').style.display = 'none';
      document.getElementById('auth-status').style.display = 'block';
      document.getElementById('auth-message').textContent = `Logged in as ${session.user.email}`;
      
      // Make the user object available to the flashcard script
      window.currentUser = session.user;
      
      // Dispatch an event to notify the flashcard script
      const event = new CustomEvent('userLoggedIn', { detail: session.user });
      document.dispatchEvent(event);
    } else {
      // User is not logged in
      document.getElementById('auth-ui').style.display = 'block';
      document.getElementById('auth-status').style.display = 'none';
      window.currentUser = null;
    }
  }
  
  // Initialize Auth UI
  const authUI = new Auth({
    supabaseClient: supabase,
    appearance: {
      theme: 'default',
      variables: {
        default: {
          colors: {
            brand: '#007bff',
            brandAccent: '#0056b3'
          }
        }
      }
      css: {
      button: 'cursor: pointer !important; pointer-events: auto !important;',
      anchor: 'cursor: pointer !important; pointer-events: auto !important;'
    }
    },
    providers: [],
    redirectTo: currentPage
  });
  
  // Render Auth UI
  authUI.render('#auth-ui');
  
  // Add logout functionality
  document.getElementById('logout-btn').addEventListener('click', async function() {
    await supabase.auth.signOut();
    window.location.reload();
  });
  
  // Check user on page load
  document.addEventListener('DOMContentLoaded', checkUser);
  
  // Listen for auth state changes
  supabase.auth.onAuthStateChange((event, session) => {
    if (event === 'SIGNED_IN') {
      checkUser();
    } else if (event === 'SIGNED_OUT') {
      window.location.reload();
    }
  });
</script>

